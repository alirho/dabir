# راهنمای عملکرد و بهینه‌سازی

ویرایشگر «دبیر» با هدف سادگی و سبکی طراحی شده است، اما برای کار با اسناد بسیار بزرگ یا در محیط‌های پیچیده، رعایت برخی نکات می‌تواند به بهبود عملکرد کمک کند.

## ۱. مدیریت اسناد بزرگ

ویرایشگرهای مبتنی بر `contenteditable` ممکن است در هنگام کار با ده‌ها هزار کلمه یا بیشتر، دچار افت عملکرد شوند.

-   **تقسیم اسناد:** به جای نگه داشتن یک سند بسیار طولانی در یک ویرایشگر، آن را به بخش‌های کوچک‌تر (مانند فصل‌ها یا صفحات) تقسیم کنید و هر کدام را در یک نمونه ویرایشگر جداگانه یا به صورت جداگانه بارگذاری کنید.
-   **پردازش سمت سرور:** برای نمایش اسناد بسیار بزرگ که نیازی به ویرایش ندارند، آن‌ها را در سمت سرور به HTML تبدیل کنید و فقط در صورت نیاز کاربر به ویرایش، محتوا را در «دبیر» بارگذاری کنید.

## ۲. بارگذاری تنبل (Lazy Loading) پلاگین‌ها

اگر پلاگین‌های پیچیده‌ای دارید که ممکن است حجم زیادی داشته باشند یا به کتابخانه‌های خارجی وابسته باشند، می‌توانید آن‌ها را به صورت تنبل (Lazy) بارگذاری کنید.

به جای وارد کردن تمام پلاگین‌ها در ابتدای کار، می‌توانید از `import()` داینامیک برای بارگذاری آن‌ها در زمان نیاز (مثلاً پس از یک تعامل خاص کاربر) استفاده کنید.

```javascript
const editor = new DabirEditor('#editor');

// فرض کنید می‌خواهیم یک پلاگین سنگین را فقط زمانی که کاربر روی یک دکمه کلیک می‌کند، اضافه کنیم
document.getElementById('load-chart-plugin').addEventListener('click', async () => {
    const { ChartPlugin } = await import('./plugins/chartPlugin.js');
    editor.use(ChartPlugin);
    console.log('پلاگین نمودار بارگذاری و نصب شد!');
});
```

## ۳. بهینه‌سازی ذخیره‌سازی خودکار

ویژگی ذخیره‌سازی خودکار از یک تابع `debounce` استفاده می‌کند تا از ذخیره‌سازی مکرر در حین تایپ سریع جلوگیری کند (پیش‌فرض: هر ۲۵۰ میلی‌ثانیه). اگرچه این مقدار برای اکثر موارد مناسب است، اما در آینده ممکن است قابلیت تنظیم این زمان از طریق تنظیمات ویرایشگر اضافه شود.

برای غیرفعال کردن کامل ذخیره‌سازی خودکار (مثلاً اگر می‌خواهید ذخیره‌سازی را به صورت دستی با یک دکمه کنترل کنید)، از تنظیمات زیر استفاده کنید:

```javascript
new DabirEditor('#editor', {
    storage: {
        enabled: false
    }
});
```

## ۴. مدیریت حافظه (Memory Management)

هنگامی که دیگر به یک نمونه از ویرایشگر نیاز ندارید (مثلاً در یک اپلیکیشن تک‌صفحه‌ای (SPA) که کاربر به صفحه دیگری می‌رود)، باید شنونده‌های رویداد (Event Listeners) را حذف کنید تا از نشت حافظه (Memory Leak) جلوگیری شود.

در حال حاضر، «دبیر» یک متد `destroy()` برای این کار ارائه نمی‌دهد. این ویژگی برای نسخه‌های آینده در نظر گرفته شده است. به عنوان یک راه‌حل موقت، می‌توانید المان ویرایشگر را به طور کامل از DOM حذف کنید که باعث می‌شود بسیاری از ارجاعات داخلی توسط Garbage Collector جاوا اسکریپت پاک شوند.

## ۵. رندرینگ و به‌روزرسانی DOM

در حال حاضر، «دبیر» برای به‌روزرسانی بلاک‌ها از جایگزینی ساده المان‌ها استفاده می‌کند که برای اکثر موارد سریع و کارآمد است. فایل `src/utils/diff.js` به عنوان یک جایگاه برای پیاده‌سازی یک الگوریتم **DOM diffing** در آینده در نظر گرفته شده است. الگوریتم‌های diffing (مانند `morphdom`) می‌توانند با مقایسه دو درخت DOM و اعمال کمترین تغییرات لازم، عملکرد را در هنگام به‌روزرسانی‌های مکرر و پیچیده به طور قابل توجهی بهبود بخشند.
