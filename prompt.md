## پرامپت ۱
من می‌خوام یک صفحه وب ساده داشته باشم تا توش بتونم بنویسم، نمی‌خوام هیچ ویژگی داشته باشه. فقط امکان یادداشت برداری داشته باشه. مثل یک صفحه A4 خالی.

## پرامپت ۲
حالا می‌خوام قالب‌های مارک‌داون زیر در اون پشتیبانی بشه:
- پررنگ کردن (bold)
- کج کردن (italic)
- پیوند (link)


## پرامپت ۳
من نمی‌خوام صفحه دو بخش داشته بشه می‌خوام یک بخش داشته باشه و در همون یک بخش بنویسم و مارک‌دوان نمایش داده بشه.

## پرامپت ۴
پس از زمان کوتاهی توقف در حال تایپ مکان‌نما (cursor) به ابتدای خط می‌ره.

## پرامپت ۵
در زمان اجرا در کنسول مرورگر خطای زیر نمایش داده می‌شه:

```js
Uncaught SyntaxError: unterminated regular expression literal
```

## پرامپت ۶
کد خطایی که فرستادم مربوط به regex پیوند بود.

## پرامپت ۷
بخش فرمت پینود رو حذف کن. فقط پررنگ و کج کردن باشه.

## پرامپت ۸
حالا می‌خوام فرمت پبوند برای مارک‌دوان را هم اضافه کنی.

## پرامپت ۹
در کنسول خطای زیر نمایش داده می‌شه:

```js
80:53 Uncaught SyntaxError: unterminated regular expression literal
```

## پرامپت ۱۰
مشکل بر طرف نشده و خطا نمایش داده می‌شه. فکر کنم مشکل مربوط به این بخش از کد باشه:

```js
 if ((match = text.match(/```math
([^```]+)```KATEX_INLINE_OPEN([^)]+)KATEX_INLINE_CLOSE\s$/))) {
                        replaceMarkdown(node, match, (m) => {
                            const a = document.createElement('a');
                            a.href = m[2];
                            a.textContent = m[1];
                            a.target = '_blank';
                            return a;
                        });
                    }
```

## پرامپت ۱۱
خب مشکل بر طرف شد، اما زمانی که پیوند نمایش داده می‌شه قابل کلیک کردن نیست. فقط متن به رنگ آبی دراومده.

## پرامپت ۱۲
حالا لطفا فرمت خط زدن مارک‌داون را هم اضافه کن.

## پرامپت ۱۳
خب حالا فرمت‌بندی عنوان‌های یک تا چهار مارک‌دوان را پیاده‌سازی کن.

## پرامپت ۱۴
حالا ویژگی نقل‌قول را پیاده‌سازی کن.

## پرامپت ۱۵
می‌خوام در نقل‌قول اگر کاربر دوباره کلید enter را زد وارد یک خط جدید خالی بشه.

## پرامپت ۱۶
می‌خوام با زدن دوبار کلید enter در نقل‌قول وارد حط جدید حالی بشه.

## پرامپت ۱۷
هنوز با زدن دوبار دکمه enter کاربر در بخش واگویه است و وارد خط جدید خالی از فرمت‌بندی نمی‌شه.

## پرامپت ۱۸
حالا فرمت‌بندی لیست مرتب (Ordered Lists) را پیاده‌سازی کن.

## پرامپت ۱۹
فرمت‌بندی لیست نامرتب (Unordered Lists) را اضافه کن.

## پرامپت ۲۰
فرمت‌بندی بازبینه (checklist) رو اضافه کن.

## پرامپت ۲۱
زمانی که می‌خوام فرمت بازببنه ایجاد کنم تبدیل به لیست نامرتب می‌شه. نخست نویسه - را وارد می‌کنم و بعد space می‌زنم و بعد از اون نویسه [ را وارد می‌کنم و بعد که space می‌زنم تبدیل به لیست نامرتب می‌شه و بعد که نویسه ] وارد می‌کنم دیگه اتفاقی نمی‌افته.

## پرامپت ۲۲
فرمت‌بندی کد تک خطی با نویسه‌های `` و کد چندخطی با نویسه‌های ``` را اضافه کن.

## پرامپت ۲۳
فرمت جدول را اضافه کن.

## پرامپت ۲۴
لطفا کد این بخش را به صورت کامل بهم بده:

```
editor.addEventListener('keydown', (e) => {
```

## پرامپت ۲۵
فرمت عکس را هم اضافه کن.

## پرامپت ۲۶
لطفا کد این بخش را به صورت کامل بهم بده:

```
editor.addEventListener('keydown', (e) => {
```

## پرامپت ۲۷
با تایپ `![توضیحات عکس](آدرس-عکس.jpg)` و زدن کلید `Enter` عکس نمایش داده نمی‌شه.

## پرامپت ۲۸
لطفا کد این بخش را به صورت کامل بهم بده:

```
editor.addEventListener('keydown', (e) => {
```

> تا پرامپت ۲۸ از [lmarena](https://lmarena.ai) برای پیاده‌سازی استفاده شده است و پس از آن از [aistudio](https://aistudio.google.com) استفاده شده.

## پرامپت ۲۹
با توجه به کدهای موجود در فایل pmdGemini.html امکان ایجاد لیست‌های نامرتب تودرتو را تا چهار سطح اضافه کن.

## پرامپت ۳۰
می‌خوام به لیست‌های مرتب امکان ایجاد لیست تودرتو را تا سه سطح اضافه کنی.
سطح یک: 1
سطح دو: 1.1
سطح سه: 1.1.1

## پرامپت ۳۱
در لیست‌های مرتب و نامرتب و بازبینه (cheklist) امکان وارد کردن فرمت‌های زیر اضافه بشه:
- پررنگ
- کج
- پیوند
- کد تک خطی
- خط خورده

## پرامپت ۳۲
با زدن دوبار کلید enter از نقل‌قول حارج بشه و وارد خط جدید و خالی از فرمت بشه.

## پرامپت ۳۳
کدی که نوشتی مشکل را بر طرف نکرد. اگر کاربر داخل فرمت نقل‌قول یک واژه یا جمله نوشته باشه هر چندتا enter که بزنه به همون تعداد خط در بخش نقل‌قول اضافه می‌شه. در حالیکه با زدن دو enter باید از نقل قول خارج بشه.

## پرامپت ۳۴
در بخش بازبینه، کاربر می‌تونه بر روی کل خط کلیک کنه و حالت متن را به انجام شده تغییر بده، می‌خوام قابلیت کلیک کردن فقط بر روی بخش checkbox باشه.

## پرامپت ۳۵
با کلیک کردن بر روی چک‌باکس وضعیتش تغییر نمی‌کنه.

## پرامپت ۳۶
با زدن دکمه space فرمت‌بندی‌های زیر نمایش داده می‌شن، می‌خوام با زدن دکمه enter هم این اتفاق بیفته.
- عنوان
- پررنگ
- کج کردن
- خط زده
- لیست مرتب
- لیست نامرتب
- نقل‌قول
- کد
- پیوند

## پرامپت ۳۷
در قالب لیست مرتب در سطح نخست فاصله اعداد با متن زیاد است و در سطح چهارم متن با اعداد تداخل داره. می‌خوام فاصله اعداد با متن در تمام سطح‌ها یکسان باشه.

فاصله مورد نظر هم فاصله‌ایه که در سطح سه بین عدد و متن وجود داره.

## پرامپت ۳۸
تغییراتی که دادی مشکل‌های زیر را داره:
1. فاصله در سطح‌های یک و دو هنوز زیاده و با فاصله سطرهای سه و چهار یکسان نیست.
2. نویسه (.) باید بعد از اعداد قرار بگیره ولی الان در اول نویسه (.) نمایش داده می‌شه و بعد عدد.

## پرامپت ۳۹
مشکل فاصله متن با اعداد هنوز بر طرف نشده، بهترین فاصله بین اعداد و متن در سطح چهار است.

## پرامپت ۴۰
باز هم مشکل حل نشد و هنوز فاصله اعداد و متن در سطح‌های یک تا سه زیاده. به خصوص در سطح یک.

## پرامپت ۴۱
در قالب بازبینه (checcklist) وقتی متن را با backspace پاک می‌کنم خود چک‌باکس حذف نمی‌شود.

## پرامپت ۴۲
تغییری که ایجاد کردی بازبینه را حذف می‌کنه اما اگر چند خط بازبینه داشته باشیم، با حذف هر کدوم از بازبینه‌ها مکان‌نما به ابتدای لیست بازبینه‌ها میره و یک خط جدید ایجاد می‌کنه. در حالیکه باید به بازبینه قبلی خودش بره.

## پرامپت ۴۳
در بازبینه هم امکان ایجاد بازبینه‌های تودرتو در چهار سطح وجود داشته باشه.

## پرامپت ۴۴
تغییراتی که ایجاد کردی بازبینه‌های تودرتو را به خوبی نشون نمی‌ده، بازبینه‌ها زیر هم قرار نمی‌گیرند بلکه روبروی هم قرار می‌گیرند.

عکس مشکل را بارگذاری کردم.

## پرامپت ۴۵
می‌خوام مستندات زیر را برای پروژه بنویسی:

1. درباره READM
    - توضیح درباره پروژه
    - نام پروژه: دبیر
    - ویژگی‌های پروژه
    - نحوه راه‌اندازی
    - مجوز MIT
2. تاریخچه تغییرات changelog

مستندات به فارسی باشه.

## پرامپت ۴۶
در قالب جدول اگر سلول‌های یک سطر خالی بود و اگر در اولین ستون این سطر دکمه backspace زده شده کل سطر حذف بشه. دقت کن که تموم سلول‌های اون سطر باید خالی باشه.

## پرامپت ۴۷
عنوان (header) جدول با backspace حذف نمی‌شه.

## پرامپت ۴۸
در قالب جدول برای تراز کردن متن داخل سلول‌ها موارد زیر را پیاده‌سازی کن:
1. اگر نویسه : ابتدای --- بود متن‌های داخل سلول راست‌چین باشن.
2. اگر نویسه : انتهای --- بود متن چپ‌چین باشه
3. اگر نویسه : ابتدا و انتهای --- بود متن‌ها وسط چین بشن.

## پرامپت ۴۹
در قالب جدول تغییرات زیر را اعمال کن:
1. با زدن دکمه enter و رفتن به سطر جدید ارتفاع آن کم است وقتی که نویسه وارد می‌شه ارتفاع درست می‌شه. باید از همون ابتدا ارتفاع سلول‌های سطر به اندازه ارتفاع عنوان جدول باشه.
2. عرض سلول‌ها ثابت باشه و اگر متن طولانی بود ارتفاع سطر افزایش پبدا کنه.
3. اگر کاربر در آخرین سلول یک سطر کلید tab را زد یک ستون جدید ایجاد بشه.

## پرامپت ۵۰
اگر در ابتدای ایجاد جدول تراز متن‌های سلول‌ها مشخص شده باشه با زدن دکمه tab و افزوده شدن ستون جدید، ترازها در ستون جدید اعمال نمی‌شه.

## پرامپت ۵۱
با زدن دکمه enter فرمت‌های زیر اعمال نمی‌شن و باید حتما دکمه space را زد:
1. پررنگ
2. کج
3. خط خورده
4. پیوند

## پرامپت ۵۲
می‌خوام زمانی که مکان‌نما (cursor) بر روی یکی از فرمت‌های مارک‌داون قرار گرفت از حالت render شده به HTML خارج بشه و فرمت نوشتاری مارک‌دوان نمایش داده بشه. و زمانیکه که مکان‌نما از فرمت نوشتاری مارک‌داون خارج شد دوباره رندر بشه.

بطور مثال اگر مکان‌نما بر روی بخشی که پررنگ شده قرار گرفت نویسه‌های ** دو طرف اون بخش نمایش داده بشه.

## پرامپت ۵۳
در حال حاضر کاربر باید روی بخش فرمت‌بندی شده کلیک کنه تا متن خام مارک‌دوان نمایش داده بشه، می‌خوام اگر مکان‌نما با کیبورد هم جابجا شد این اتفاق بیافته.

## پرامپت ۵۴
با تغییری که ایجاد کردی فرمت‌بندی عکس کار نمی‌کنه و تبدیل به پیوند می‌شه. مثلا با نوشتن «![alt text](dabir.svg)» پیوند نمایش داده می‌شه.

## پرامپت ۵۵
قالب‌بندی‌های زیر هم زمانی که مکان‌نما بر روی اون‌ها قرار بگیرند به صورت متن خام نمایش داده بشن:
1. عکس
2. نقل‌قول

## پرامپت ۵۶
ازت می‌خوام با توجه به تغییراتی که دادی فایل‌های «مرا بخوان» و «تاریخچه تغییرات» را بروز کنی.

## پرامپت ۵۷
می‌خوام جهت متن به صورت خودکار تشخیص داده بشه، اما باید موارد زیر رعایت بشه:
1. به صورت پیش‌فرض جهت متن راست به چپ باشه (فارسی)
2. نویسه‌های قالب‌بندی مارک‌دوان تاثیری در جهت نداشته باشند. یعنی اگر کاربر در ابتدای خط * وارد کرد همچنان به صورت پیش‌فرض جهت خط از راست به چپ باشه تا زمانی که نخستین نویسه‌ای که وارد کرد فارسی نباشه.
3. جهت هر خط به صورت جداگانه بررسی بشه.

## پرامپت ۵۸
می‌خوام زمانی که کاربر یک بخش یا کل متن را از ویرایشگر رونوشت (copy) می‌کنه به صورت مارک‌دوان خالص رونوشت بشه.

## پرامپت ۵۹
توضیحات رونوشت گرفتن و تشخیص خودکار جهت متن را به فایل README اضافه کن.

## پرامپت ۶۰
وقتی که یک متن خام مارک‌دوان را paste می‌کنم قالب‌های مارک‌داون به صورت خام نمایش داده می‌شن و به html رندر نمی‌شن.

## پرامپت ۶۱
من می‌خوام این فایل را به یک کتابخانه جاوا اسکریپت حرفه‌ای و قابل حمل بازسازی کنی تا بتوان به راحتی در هر پروژه وبی از آن استفاده کرد. نام کتابخانه **«Dabir.js»**

### ساختار فایل‌ها
خروجی نهایی باید شامل سه فایل مجزا باشه:
- `dabir.js`: فایل اصلی کتابخانه جاوا اسکریپت.
- `dabir.css`: فایل استایل‌های ویرایشگر.
- `index.html`: یک فایل مثال تمیز که نحوه استفاده از کتابخانه را نمایش می‌ده.

### بازسازی جاوا اسکریپت (`dabir.js`)
- تمام منطق جاوا اسکریپت را داخل یک کلاس مدرن ES6 کپسوله کن. نام آن را `DabirEditor` بگذار.
- سازنده (`constructor`) کلاس باید یک انتخاب‌گر CSS (مانند `'#my-editor'`) برای شناسایی `<div>` هدف که قراره به ویرایشگر تبدیل بشه، قبول کنه.
- سازنده همچنین باید یک شیء `options` اختیاری برای تنظیمات (مانند `placeholder` و `storageKey`) بپذیره.
- تمام شنوندگان رویداد (`keydown`, `keyup`, `click` و غیره) و توابع کمکی موجود باید به متدهای این کلاس تبدیل بشن.
- کتابخانه نباید هیچ متغیر یا تابع عمومی (global) داشته باشه.

### بازسازی CSS (`dabir.css`)
- تمام کدهای CSS را از تگ `<style>` به فایل `dabir.css` منتقل کن.
- **نکته بسیار مهم:** انتخاب‌گرهای CSS را اصلاح کن. به جای وابستگی به یک ID ثابت مانند `#editor`، از یک کلاس عمومی استفاده کن که کتابخانه به صورت خودکار به المان هدف اضافه می‌کنه، برای مثال `.dabir-editor`. این کار برای قابلیت استفاده مجدد ضروری است.

### فایل مثال (`index.html`):**
- یک فایل `index.html` حداقلی بساز که نحوه استفاده از کتابخانه جدید را نمایش بده.
- این فایل باید شامل تگ `<link>` برای `dabir.css` در بخش `<head>` باشه.
- باید شامل تگ `<script>` برای `dabir.js` در انتهای `<body>` باشه.
- باید حاوی یک `<div>` ساده (مثلاً `<div id="my-editor"></div>`) باشه.
- در نهایت، باید کد ساده راه‌اندازی جاوا اسکریپت را نمایش بده، مانند: `new DabirEditor('#my-editor');`.

## پرامپت ۶۲
با تغییراتی که اعمال کردی قالب پیوند کار نمی‌کنه.

## پرامپت ۶۳
باگ‌های زیر را بر طرف کن:
1. در قالب بازبینه، اگر بازبینه والد تیک زده شود متن‌های موجود در بازبینه‌های فرزند به درستی خط می‌خورد اما تیک checkbox زده نمی‌شه.
2. در قالب کد می‌شه به صورت بی‌نهایت خط خالی اضافه کرد. در حالکیه اگر کاربر در یک خط خالی کلید enter را زد باید از قالب کد خارج بشه.

## پرامپت ۵۴
مشکل خروج از قالب کد با دوبار زدن کلید enter بر طرف نشده.

## پرامپت ۵۵
اگر در ابتدای متن قالب عنوان وارد بشه به HTML رندر نمی‌شه.

## پرامپت ۵۶
زمانیکه که به بخشی از متن نویسه‌های قالب‌بندی مارک‌دوان را اضافه می‌کنم و با استفاده از کلیدهای جهت کیبورد مکان مکان‌نما (cursor) را تغییر می‌دم متن به مارک‌داون رندر نمی‌شه. برای رندر شدن باید حتما اینتر زد.

باید زمانی که بخشی از متن دارای نویسه‌های قالب‌بندی مارک‌دوان هست با جابجایی مکان‌نما رندر بشه.

## پرامپت ۵۷
تغییراتی که ایجاد کردی مشکل را حل نکرد. مشکل اینکه اگر یک متنی از قبل نوشته شده باشه و من بخوام به یک واژه یا بخشی از متن قالب‌بندی مارک‌دوان اضافه کنم برای اینکه اعمال بشه باید حتما اینتر یا فاصله بزنم.

به طور مثال در جمله «این یک آزمون است.» می‌خوام واژه آزمون را پررنگ کنم، برای این کار ابتدا و انتهای اون واژه دو نویسه * اضافه می‌کنم و بعد با استفاده از کلیدهای کیبورد مکان‌نما را جابجا می‌کنم من توقع دارم با این کار واژه آزمون پررنگ بشه ولی این اتفاق نمی‌افته.

## پرامپت ۵۸
تغییراتی که ایجاد کردی به خوبی کار می‌کنه اما مشکلی که داره اینکه حتما باید مکان‌نما از خط خارج بشه تا قالب‌بندی رندر بشه. من می‌خوام بعد از خارج شدن از اون بخش متن رندر بشه.

## پرامپت ۵۹
تغییری که ایجاد کردی اوضاع رو بدتر کرد حالا اصلا رندر نمی‌شه.

## پرامپت ۶۰
قالب خط افقی با نویسه‌های --- را اضافه کن.

## پرامپت ۶۱
در نقل‌قول قالب‌های خطی مانند پررنگ، کج، خط خورده، کد، پیوند، بازبینه و لیست‌ها نمایش داده نمی‌شه.

## پرامپت ۶۲
در لیست‌ها با رفتن بر روی بخش‌های قالب‌بندی شده به صورت متن خام نمایش داده نمی‌شوند.

## پرامپت ۶۳
قالب برجسته کردن (highlight) با نویسه‌های == در دو طرف متن را اضافه کن. دقت کن که یک قالب‌بندی خطی است و باید در تمام بخش‌های قالب‌ها مارک‌دوان قابل نمایش باشه.

## پرامپت ۶۴
می‌خوام اگر کاربر اعداد فارسی هم مشابه اعداد انگلیسی به عنوان لیست مرتب تشخیص داده بشن و کاملا مشابه باشه.

یعنی اگر کاربر در ابتدای خط نویسه‌های  «۱.» را وارد کرد به عنوان لیست مرتب در نظر گرفته .بشه

## پرامپت ۶۵
می‌خوام جعبه‌های توضیحی زیر را پیاده‌سازی کنی:
1. هشدار: با نویسه‌های «...هشدار» آغاز بشه و پایانش هم «...» باشه.
2. توجه: با نویسه‌های «...توجه» آغاز بشه و پایانش هم «...» باشه.
3. نکته: با نویسه‌های «...نکته» آغاز بشه و پایانش هم «...» باشه. 
4. مهم: با نویسه‌های «...مهم» آغاز بشه و پایانش هم «...» باشه.
5. احتیاط: با نویسه‌های «...احتیاط» آغاز بشه و پایانش هم «...» باشه.

می‌خوام مشابه گیت‌هاب پیاده‌سازی بشن.

## پرامپت ۶۶
زمانیکه به متن زیر را وارد می‌کنم هیچ اتفاقی نمی‌افته.

...هشدار
این یک هشدار است.
...

## پرامپت ۶۷
ازت می‌خوام آیکون‌های ابتدای جعبه‌های توضیحی را حذف کنی.

## پرامپت ۶۸
اگر در خط نخست قالب عنوان وارد بشه با زدن دکمه اینتر رندر نمی‌شه.

## پرامپت ۶۹
در قالب بازبینه، اگر مکان‌نما را به ابتدای متن منتقل کنم با زدن backspace بازبینه حذف نمی‌شه.

اگر مکان‌نما در ابتدای متن بازبینه قرار گرفت و کاربر کلید backspace را زد باید بازبینه حذف بشه و متن باقی مونده با یک نویسه space در ادامه متن بازبینه بالایی قرار بگیره.

## پرامپت ۷۰
اگر در وسط لیستی از بازبینه‌ها دکمه اینتر زده بشه یک بازبینه خالی ایجاد می‌شه اما مکان‌نما به جای اینکه بر روی بازبینه جدید قرار بگیره بر روی بازبینه پایینی قرار می‌گیره.

## پرامپت ۷۱
زمانی که با استفاده از کلیدهای arrow up و arrow down کیبورد بین بازبینه‌ها جابجا می‌شه برای جابجا شدن باید دوباره کلید را بزنم. مکان‌نما ابتدا پشت checkbox قرار می‌گیره و بعد وارد متن بازبینه می‌شه.

## پرامپت ۷۲
تغییری که ایجاد کردی با کلید arrow up کار نمی‌کنه.

## پرامپت ۷۳
برای قالب‌های نقل‌قول و جعبه‌های توضیحی تغییرات زیر را اعمال کن:
1. اگر کاربر وارد اون‌ها شد حالت خام را نمایش نده و حالت رندر شده را نمایش بده.
2. با زدن کلید اینتر در یک خط خالی از قالب خارج بشه.
3. قالب‌های خطی مارک‌دوان در اون‌ها پشتیبانی بشه.
4. اگر کاربر مکان‌نما را در ابتدای خط نخست قرار داد و کلید backspace را زد قالب‌بندی خام نمایش داده بشه با حذف فاصله بین نویسه و متن.

## پرامپت ۷۴
زمانی که در ابتدای خط نخست یک نقل‌قول کلید backspace را می‌زنم به درستی حال خام قالب نمایش داده می‌شه. اما مشکل اینجاست که وقتی دوباره بین نویسه > مربوط به نقل قول و متنی که از قبل نوشتم فاصله ایجاد می‌کنم متن پاک می‌شه و یک قالب نقل‌قول خالی اجاد می‌شه. نباید متن پاک بشه.

## پرامپت ۷۵
در جعبه‌های توضیحی اگر در ابتدای خط نخست کلید backspace را بزنم متن به درستی به حالت قالب خام نمایش داده می‌شه، اما مشکل اینجاست زمانی که از حالت فالب خام خارج می‌شم دیگه به صورت خودکار رندر نمی‌شن و همون قالب خام نمایش داده می‌شه.

## پرامپت ۷۶
می‌خوام زمانیکه که مکان‌نما جابجا می‌شه رندر قالب‌های مارک‌دوان انجام بشه.

مثلا من جمله «این یک آزمون است.» را نوشتم و پس از نوشتن می‌خوام واژه «آزمون» را پررنگ کنم، با جابجایی مکان‌نما با استفاده از کیبورد به ابتدا و انتهای واژه نویسه‌‌های ** را اضافه می‌کنم. اما حتما باید اینتر یا space را بزنم تا متن رندر بشه. اما باید با جابجا شدن مکان‌نما متن رندر بشه.

## پرامپت ۷۷
تغییری که ایجاد کردی خوبه، اما باید حتما پس اضافه کردن نویسه‌‌های قالب مارک‌دوان در انتهای جمله اینتر زد تا رندر انجام بشه. من می‌خوام فقط با جابجا کردن مکان‌نما این اتفاق بیافته چه با کیبورد چه با کلیک کردن ماوس.

منطق کار باید به این شکل باشه: هرجایی که نویسه‌های قالب خطی مارک‌دوان وارد شد بعد از این که مکان‌نما از محدوده اون نویسه‌های خارج شد باید رندر بشه و وقتی مکان‌نما وارد محدوده شد باید به صورت خام نمایش داده بشه.

## پرامپت ۷۸
کارکردش بهتر شد اما هنوز اگر من به یک واژه از پیش نوشته شده نویسه‌های نشانه‌گذاری مارک‌دوان را اضافه کنم برای رندر شدن حتما باید مکان‌نما از جمله خارج شود.

## پرامپت ۷۹
اگر جمله‌ای از پیش وجود داشته باشه و من در بالای اون نشانه‌گذاری یکی از بلاک‌ها توضیحی را اضافه کنم، اون بخش به قرار گرفته بین نشانه‌گذاری به بلاک توضیحی رندر نمی‌شه.

## پرامپت ۸۰
می‌خوام تگ‌های HTML هم در دبیر قابل رندر شدن باشه. مثل همه ویرایشگر‌های مارک‌دوان دیگه.

## پرامپت ۸۱
زمانی که محتوایی شامل HTML را paste می‌کنم رندر به درستی انجام می‌شه، اما زمانی که خودم اون را در دبیر می‌نویسم کار نمی‌کنه.

## پرامپت ۸۲
می‌خوام تگ‌های HTML هم مثل نشانه‌گذاری‌های مارک‌داون زمانی که مکان‌نما بر روی اون‌‌ها قرار می‌گیره نمایش داده بشه.

## پرامپت ۸۳
می‌خوام پروژه را با معماری بهتر و کد تمیزتر بازنویسی کنی.

مشکلات فعلی:
1. متدهای بسیار طولانی (برخی بیش از 200 خط)
2. تکرار کد زیاد
3. همه چیز در یک فایل و یک کلاس
4. سخت بودن تست و نگهداری
5. عدم وجود سیستم plugin
6. Event listener های پیچیده و طولانی

معماری مورد نظر برای نسخه جدید:
می‌خوام پروژه به صورت ماژولار پیاده‌سازی بشه.

1. ساختار فایل‌ها:
```
src/
├── core/
│   ├── editor.js         // کلاس اصلی و هماهنگ‌کننده
│   ├── selection.js      // مدیریت selection و cursor
│   ├── storage.js        // ذخیره و بازیابی
│   └── eventEmitter.js   // سیستم رویداد داخلی
├── parsers/
│   ├── markdownParser.js // تبدیل markdown به HTML
│   ├── htmlParser.js     // تبدیل HTML به markdown  
│   ├── inlineParser.js   // پردازش عناصر inline
│   └── blockParser.js    // پردازش عناصر block
├── handlers/
│   ├── keyboardHandler.js // مدیریت keyboard events
│   ├── mouseHandler.js    // مدیریت mouse events
│   ├── clipboardHandler.js // مدیریت copy/paste
│   └── inputHandler.js     // مدیریت input events
├── renderers/
│   ├── renderer.js        // رندر کننده اصلی
│   ├── inlineRenderer.js  // رندر عناصر inline
│   └── blockRenderer.js   // رندر عناصر block
├── plugins/
│   ├── plugin.js          // کلاس پایه plugin
│   ├── tablePlugin.js     // منطق جداول
│   ├── listPlugin.js      // منطق لیست‌ها
│   ├── admonitionPlugin.js // منطق admonitions
│   └── directionPlugin.js  // منطق RTL/LTR
├── utils/
│   ├── dom.js            // توابع کمکی DOM
│   ├── regex.js          // الگوهای regex
│   ├── debounce.js       // توابع performance
│   └── diff.js           // محاسبه تفاوت DOM
└── index.js              // نقطه ورود اصلی
```

2. طراحی API:
API باید تمیز، قابل فهم و در صورت امکان زنجیره‌ای (chainable) باشد. این API باید متدهای واضحی برای دستکاری محتوا، مدیریت وضعیت و توسعه‌پذیری فراهم کند.

```javascript
// استفاده پایه
const editor = new DabirEditor('#editor', {
    placeholder: 'اینجا بنویسید...',
    plugins: [TablePlugin, ListPlugin],
    storage: {
        enabled: true,
        key: 'my-content'
    }
});

// سیستم plugin
editor.use(CustomPlugin);

// Event API
editor.on('change', (content) => {});
editor.on('selection', (range) => {});

// متدهای عمومی
editor.getMarkdown();
editor.getHTML();
editor.setContent(content, format);
editor.clear();
editor.focus();
editor.destroy();

// دسترسی به ماژول‌ها
editor.parser.registerRule(name, pattern, handler);
editor.renderer.registerComponent(name, component);
```

3. نمونه کد برای ماژول‌ها:

```javascript
// Parser با قابلیت گسترش
class MarkdownParser {
    constructor() {
        this.rules = new Map();
        this.blockRules = [];
        this.inlineRules = [];
    }
    
    registerBlockRule(rule) {
        this.blockRules.push(rule);
        this.blockRules.sort((a, b) => b.priority - a.priority);
    }
    
    parse(markdown) {
        const ast = this.parseToAST(markdown);
        return this.astToHTML(ast);
    }
}

// Handler با separation of concerns
class KeyboardHandler {
    constructor(editor) {
        this.editor = editor;
        this.shortcuts = new Map();
        this.registerDefaultShortcuts();
    }
    
    register(key, modifiers, handler) {
        const shortcut = this.normalizeShortcut(key, modifiers);
        this.shortcuts.set(shortcut, handler);
    }
    
    handle(event) {
        const shortcut = this.getShortcutFromEvent(event);
        const handler = this.shortcuts.get(shortcut);
        if (handler) {
            handler(event, this.editor);
        }
    }
}

// Plugin system
class Plugin {
    static install(editor, options) {
        throw new Error('Plugin must implement install method');
    }
}

class TablePlugin extends Plugin {
    static install(editor, options) {
        // ثبت parser rules
        editor.parser.registerBlockRule({
            name: 'table',
            priority: 50,
            pattern: /^\|.+\|$/,
            parse: this.parseTable
        });
        
        // ثبت keyboard shortcuts
        editor.keyboard.register('Tab', [], this.handleTab);
        editor.keyboard.register('Enter', [], this.handleEnter);
        
        // ثبت renderer
        editor.renderer.registerComponent('table', TableComponent);
    }
}
```

4. ویژگی‌های مهم که باید حفظ شوند:
1. تمام قابلیت‌های مارک‌داون فعلی
2. ویرایش درجا (کلیک روی عناصر برای تبدیل به مارک‌داون)
3. تشخیص خودکار جهت متن (RTL/LTR)
4. ذخیره‌سازی خودکار
5. مدیریت هوشمند selection و cursor
6. پشتیبانی از copy/paste با حفظ فرمت

5. بهبودهای مورد نظر:
1. **Performance**: استفاده از virtual DOM یا diff algorithm
2. **Bundle size**: tree-shaking و lazy loading برای plugins
3. **Type safety**: اضافه کردن JSDoc یا TypeScript definitions
4. **Testing**: ساختار testable با dependency injection
5. **Extensibility**: API واضح برای توسعه‌دهندگان
6. **Error handling**: مدیریت بهتر خطاها با error boundaries

6. خروجی مورد نظر:
1. کد ES6+ مدرن و clean
2. هر ماژول حداکثر 200 خط
3. توابع حداکثر 50 خط
4. کامنت‌های JSDoc برای API عمومی
5. README با مثال‌های استفاده
6. حفظ سازگاری با API فعلی (backward compatibility)

## پرامپت ۸۴
تغییراتی که ایجاد کردی باعث شده هیچ نشان‌گذاری مارک‌دوانی رندر نشه

## پرامپت ۸۵
مشکل بر طرف نشد، با وارد کردن نشانه‌گذاری‌های مارک‌دوان هیچکدوم رندر نمی‌شن.

## پرامپت ۸۶
باز دن دکمه space نشانه‌گذاری‌های خطی مارک‌داون تبدیل نمی‌شن. مثلا متن زیر هنوز به صورت خام نمایش داده می‌شه.

این یک آزمون است و هیچ ارزش دیگری ندارد.

## پرامپت ۸۷
در نقل‌قول و جعبه‌های توضیحی در خط خالی اگر اینتر زده بشه از اون‌ها خارج نمی‌شه.

## پرامپت ۸۸
در قالب نقل‌قول پس از نشانه‌گذاری آن اگر شروع به نوشتن کنم خط نخست را خالی می‌کنه و از خط دوم شروع به نوشتن می‌کنه.

## پرامپت ۸۹
در یک خط اگر چند نشانه‌گذازی خطی باشد، فقط آخرین آن‌ها رندر می‌شه و نشانه‌گذاری‌های بقیه حذف می‌شه.